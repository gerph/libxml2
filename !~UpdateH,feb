| !~UpdateH
| Utility to merge files between two different versions, the last version,
| the RISC OS version of that, and the new unix version

| Syntax: !~UpdateH <theirname> <ourname> <oldtheirname> <oldourname>

unset FromFile
unset ToFile
unset OldFromFile
unset OldToFile

| Echo Updating %*0
Set FromFile %0
If "%1" <> "" Then Set ToFile %1 Else Set ToFile %0
If "%2" <> "" Then Set OldFromFile %2 Else Set OldFromFile %0
If "%3" <> "" Then Set OldToFile %3 Else Set OldToFile <ToFile>
Echo *** Processing %0

| Do diff of last version
do gnudiff -P -w -C 2 <LastOriginal>.<OldFromFile> <LastRISCOS>.<OldToFile> > diffs.<ToFile>

| Remove any files left behind by a previous attempt
remove <ThisRISCOS>.<ToFile>
remove <ThisRISCOS>.<ToFile>/rej

| Patch against latest version
do patch -E -l -o <ThisRISCOS>.<ToFile> -r <ThisRISCOS>.<ToFile>/rej <ThisOriginal>.<FromFile> diffs.<ToFile>
perl -e "if (-z '<ThisRISCOS>.<ToFile>') { unlink '<ThisRISCOS>.<ToFile>'; }"

IfThere <ThisRISCOS>.<ToFile> Then Else Copy <ThisOriginal>.<FromFile> <ThisRISCOS>.<ToFile> ~C~V~DF
